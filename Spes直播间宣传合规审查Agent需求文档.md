# Spes直播间宣传合规审查Agent需求文档

## 1. 引言

本需求文档旨在详细阐述Spes直播间宣传合规审查Agent的开发需求。该Agent的核心目标是自动化审查直播宣传文案的合规性，确保其符合Spes内部的合规指引，从而降低人工审核成本，提高审查效率，并有效规避潜在的法律和品牌风险。本Agent将作为Spes内容生产流程中的关键一环，为营销团队提供快速、准确的合规反馈。

## 2. 目标

*   **自动化审查**：实现对直播宣传文案的自动化合规审查，减少人工干预。
*   **多源输入支持**：支持纯文本输入，并能加载用户提供的审核细则文档作为合规知识库。
*   **精准合规匹配**：根据用户提供的审核细则，精准识别文本中的违规词汇、表述，并进行分类和风险等级评估。
*   **结构化结果输出**：将审查结果以标准化的表格形式输出。
*   **提升效率**：显著缩短合规审查周期，提高内容发布效率。
*   **风险规避**：有效识别并预警潜在的合规风险，保护品牌声誉。

## 3. 功能需求

### 3.1 输入处理模块

**FR-001：输入参数定义**
*   Agent应接收两个输入参数：`text`（待审查文本，字符串）和 `guide`（已加载的 Spes 合规指引文本，权威来源，无需外部词表）。

**FR-002：文本输入预处理**
*   若 `text` 包含方括号字符 `[` 或 `]`，Agent应**仅删除括号字符**（保留括号内文字），再进行审查。

### 3.2 文本预处理模块

**FR-003：方括号字符处理**
*   Agent应能识别并删除待审查文本中的方括号字符 `[` 和 `]`，同时保留括号内的文字内容。

**FR-004：首尾空白去除**
*   Agent应能去除待审查文本首部和尾部的所有空白字符（空格、制表符、换行符等）。

**FR-005：标点符号统一**
*   Agent应能将文本中的全角标点符号统一转换为半角标点符号。

**FR-006：大小写转换**
*   Agent应能将待审查文本中的所有ASCII英文字母转换为小写。
*   Agent不应对中文进行大小写转换。

### 3.3 产品名提取模块

**FR-007：产品名提取**
*   Agent应能从预处理后的文本中提取产品名称（例如：从“【多肽蓬蓬瓶】本产品能根治脱发...”中提取“多肽蓬蓬瓶”）。
*   若提取失败，则默认产品名为空，执行全部匹配。

**FR-008：产品名缺失处理**
*   如果未能成功提取产品名称，Agent应将产品名默认设置为空，并执行全部匹配（不区分产品专属或共性禁用词）。

### 3.4 合规匹配逻辑模块

**FR-009：优先级匹配机制**
*   Agent应优先使用提取到的产品名称，匹配该产品特有的专属禁用词汇清单。
*   如果无产品专属禁用词命中，或未提取到产品名，Agent应自动切换到共性禁用词汇库进行匹配（例如：绝对化词“立竿见影”“百分之百”）。

**FR-010：中文子串匹配**
*   Agent应支持对中文禁用词汇进行直接子串匹配，不区分大小写（英文）。

**FR-011：长词优先匹配**
*   当存在多个匹配项时，Agent应优先匹配更长的禁用词汇，以提高匹配精确度（例如：优先匹配“生发产品”而非“生发”）。

**FR-012：命中项信息记录**
*   一旦命中违规词汇，Agent需明确标明：命中词、风险类别（绝对化 / 医疗术语 / 超范围 / 产品专属禁用）、风险等级（绝对禁止 / 警告 / 灰色提醒）、指引出处（精确到具体小节或功效分类，例如：`指引 1、多肽蓬蓬瓶-修护 → 禁用词汇：“修复毛囊”`）。

**FR-013：未命中违规处理**
*   如果未命中任何违规词汇，Agent应判定为“安全通过”。

### 3.5 结果输出模块

**FR-014：结构化输出格式**
*   Agent应严格按照预设的表格格式输出审查结果。
*   **若命中违规（至少一项）**：

    ```
| 品类     | 原文输入   | 审核结果 | 命中词     | 风险类别   | 风险等级   | 规则出处     | 简要说明        |
| ------ | ------ | ---- | ------- | ------ | ------ | -------- | ----------- |
| `<品类>` | `<原文>` | 拒绝   | `<命中词>` | `<类别>` | `<等级>` | `<指引小节>` | `<一句话违规原因>` |
    ```

*   **若未命中违规**：

    ```
| 品类     | 原文输入   | 审核结果 |
| ------ | ------ | ---- |
| `<品类>` | `<原文>` | 安全通过 |
    ```

*   **举例（示例输入与输出）**：
    *   输入text = "【多肽蓬蓬瓶】本产品能根治脱发并修复毛囊，效果立竿见影"
    *   输出表格需逐条标明：

    ```
| 品类    | 原文输入                 | 审核结果 | 命中词  | 风险类别     | 风险等级 | 规则出处               | 简要说明     |
| ----- | -------------------- | ---- | ---- | -------- | ---- | ------------------ | -------- |
| 多肽蓬蓬瓶 | 本产品能根治脱发并修复毛囊，效果立竿见影 | 拒绝   | 修复毛囊 | 医疗术语     | 绝对禁止 | 指引 1、多肽蓬蓬瓶-修护      | 涉及医学治疗表述 |
| 多肽蓬蓬瓶 | 本产品能根治脱发并修复毛囊，效果立竿见影 | 拒绝   | 立竿见影 | 绝对化      | 绝对禁止 | 指引 一、核心法规依据与通用禁用原则 | 使用绝对化表述  |
    ```

**FR-015：模糊语义提示**
*   对于系统识别出的模糊语义（如“有助于缓解轻微头屑”），Agent应在输出结果中明确提示“需人工复核”。

**FR-016：无多余解释性文字**
*   Agent的输出应仅包含审查结果表格，不应包含任何多余的解释性文字。



## 4. 非功能性需求

### 4.1 性能（Performance）

**NFR-001：响应时间**
*   Agent应在接收到输入后的5秒内返回审查结果（针对常规长度文本）。
*   对于包含长篇文档的复杂输入，响应时间不应超过30秒。

**NFR-002：吞吐量**
*   Agent应支持每分钟至少处理100条审查请求。

### 4.2 可靠性（Reliability）

**NFR-003：错误处理**
*   Agent应具备健壮的错误处理机制，包括但不限于：加载合规指引失败、文本处理异常等。
*   所有错误应被记录，并能向用户提供友好的错误提示。

**NFR-004：数据一致性**
*   确保审查结果的准确性和一致性。

### 4.3 可用性（Usability）

**NFR-005：用户界面/接口**
*   Agent应提供清晰的API接口或集成到现有工作流平台，方便用户调用和集成。
*   输出结果应直观易懂，便于用户快速理解合规状态。

### 4.4 安全性（Security）

**NFR-006：数据隐私**
*   Agent在处理敏感宣传文案时，应确保数据传输和存储的安全性，符合Spes的数据隐私政策。

**NFR-007：访问控制**
*   对Agent的访问和配置应有严格的权限控制。

### 4.5 可维护性（Maintainability）

**NFR-008：代码质量**
*   Agent的代码应遵循良好的编程规范，模块化设计，易于理解和维护。

**NFR-009：规则库管理**
*   合规指引和禁用词汇库应易于更新和扩展，最好通过配置而非代码修改来实现。

### 4.6 可扩展性（Scalability）

**NFR-010：服务扩展**
*   Agent的底层服务应支持水平扩展，以应对未来业务量的增长。

## 5. 技术栈建议

*   **编程语言**：Python (丰富的文本处理能力、API集成便捷)
*   **文本处理库**：`re` (正则表达式), `unicodedata` (标点统一), `jieba` (中文分词，可选，用于更复杂的语义理解)。
*   **数据存储**：合规规则库将从用户上传的审核细则文档中读取，无需额外数据库存储。
*   **部署环境**：容器化部署 (Docker)，便于管理和扩展。

## 6. 接口定义（示例）

### 6.1 Agent输入接口

```json
{
  "text": "string",  // 待审查的纯文本内容，必填
  "guide": "string"  // 已加载的 Spes 合规指引文本（权威来源，无需外部词表），必填
}
```

*   `text` 和 `guide` 均为必填项。

### 6.2 Agent输出接口

```json
[
  {
    "category": "string",       // 品类 (产品名，若无则为空)
    "original_text": "string",  // 原始输入文本
    "review_result": "string",  // 审核结果 ("拒绝" 或 "安全通过")
    "hit_word": "string",       // 命中词 (若有)
    "risk_category": "string",  // 风险类别 (若有)
    "risk_level": "string",     // 风险等级 (若有)
    "rule_source": "string",    // 规则出处 (若有)
    "brief_description": "string",// 简要说明 (若有)
    "manual_review_needed": "boolean" // 是否需要人工复核
  }
]
```

*   如果 `review_result` 为“安全通过”，则 `hit_word`、`risk_category`、`risk_level`、`rule_source`、`brief_description` 字段可为空。
*   `manual_review_needed` 为 `true` 时，表示存在模糊语义，建议人工复核。

## 7. 部署与运维

*   **部署方式**：建议采用容器化部署（如Docker），并可集成到Kubernetes等容器编排平台，实现高可用和弹性伸缩。
*   **监控与告警**：对Agent的运行状态、性能指标（如响应时间、错误率）进行实时监控，并设置告警机制。
*   **日志管理**：详细记录Agent的运行日志、审查日志和错误日志，便于问题排查和审计。
*   **版本管理**：对Agent的代码、合规规则库进行版本管理，确保可追溯性和回滚能力。

## 8. 验收标准

*   所有功能需求（FR-XXX）均已实现，并通过测试。
*   所有非功能性需求（NFR-XXX）均已满足，并通过性能、安全等测试。
*   Agent在实际业务场景中，审查准确率达到95%以上（可根据实际情况调整）。
*   文档齐全，包括设计文档、测试报告、用户手册等。

## 9. 参考文献

[1] Spes内部合规指引 V1.0 (内部文档，具体路径略)
[2] 大型语言模型（LLM）技术原理与应用 (通用知识，无特定链接)


